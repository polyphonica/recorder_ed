{% extends 'base.html' %}
{% load static %}

{% block title %}Edit Assignment - {{ assignment.title }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-4xl">
    <div class="mb-8">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-4xl font-bold mb-2">Edit Assignment</h1>
                <p class="text-base-content/70">{{ assignment.title }}</p>
            </div>
            <a href="{% url 'assignments:teacher_library' %}" class="btn btn-outline">
                <i class="fas fa-arrow-left mr-2"></i>Back to Library
            </a>
        </div>
    </div>

    <div class="card card-section shadow-xl">
        <div class="card-body">
            <form method="post" id="assignment-form">
                {% csrf_token %}

                <!-- Title -->
                <div class="form-control mb-6">
                    <label class="label">
                        <span class="label-text font-semibold text-lg">{{ form.title.label }}</span>
                    </label>
                    {{ form.title }}
                    {% if form.title.errors %}
                        <label class="label">
                            <span class="label-text-alt text-error">{{ form.title.errors.0 }}</span>
                        </label>
                    {% endif %}
                </div>

                <!-- Instructions -->
                <div class="form-control mb-6">
                    <label class="label">
                        <span class="label-text font-semibold text-lg">{{ form.instructions.label }}</span>
                    </label>
                    {{ form.instructions }}
                    {% if form.instructions.errors %}
                        <label class="label">
                            <span class="label-text-alt text-error">{{ form.instructions.errors.0 }}</span>
                        </label>
                    {% endif %}
                </div>

                <!-- Assignment Components -->
                <div class="divider"></div>
                <h3 class="text-2xl font-bold mb-4">Assignment Components</h3>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <!-- Notation Component -->
                    <div class="form-control">
                        <label class="label cursor-pointer justify-start gap-4">
                            {{ form.has_notation_component }}
                            <span class="label-text">
                                <span class="font-semibold">{{ form.has_notation_component.label }}</span>
                                <span class="block text-sm text-base-content/70 mt-1">{{ form.has_notation_component.help_text }}</span>
                            </span>
                        </label>
                    </div>

                    <!-- Written Component -->
                    <div class="form-control">
                        <label class="label cursor-pointer justify-start gap-4">
                            {{ form.has_written_component }}
                            <span class="label-text">
                                <span class="font-semibold">{{ form.has_written_component.label }}</span>
                                <span class="block text-sm text-base-content/70 mt-1">{{ form.has_written_component.help_text }}</span>
                            </span>
                        </label>
                    </div>
                </div>

                <!-- Written Questions -->
                <div class="form-control mb-6" id="written-questions-container" style="display: none;">
                    <label class="label">
                        <span class="label-text font-semibold">{{ form.written_questions.label }}</span>
                    </label>
                    {{ form.written_questions }}
                    {% if form.written_questions.errors %}
                        <label class="label">
                            <span class="label-text-alt text-error">{{ form.written_questions.errors.0 }}</span>
                        </label>
                    {% endif %}
                    <div class="alert alert-info mt-2">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <p class="font-semibold">JSON Format Example:</p>
                            <code class="text-xs">[{"question": "What is a perfect 5th?", "type": "short"}]</code>
                        </div>
                    </div>
                </div>

                <!-- Reference Notation -->
                <div class="divider"></div>
                <h3 class="text-2xl font-bold mb-4">Reference/Example (Optional)</h3>

                <div class="form-control mb-6">
                    <label class="label">
                        <span class="label-text font-semibold">{{ form.reference_notation.label }}</span>
                    </label>
                    {{ form.reference_notation }}
                    {% if form.reference_notation.errors %}
                        <label class="label">
                            <span class="label-text-alt text-error">{{ form.reference_notation.errors.0 }}</span>
                        </label>
                    {% endif %}
                </div>

                <!-- Form Actions -->
                <div class="divider"></div>
                <div class="flex gap-4 justify-end">
                    <a href="{% url 'assignments:teacher_library' %}" class="btn btn-outline">
                        Cancel
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save mr-2"></i>Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// Show/hide written questions field based on checkbox
document.addEventListener('DOMContentLoaded', function() {
    const writtenCheckbox = document.getElementById('id_has_written_component');
    const questionsContainer = document.getElementById('written-questions-container');

    function toggleQuestions() {
        if (writtenCheckbox.checked) {
            questionsContainer.style.display = 'block';
        } else {
            questionsContainer.style.display = 'none';
        }
    }

    writtenCheckbox.addEventListener('change', toggleQuestions);
    toggleQuestions(); // Initialize on page load
});
</script>
{% endblock %}
