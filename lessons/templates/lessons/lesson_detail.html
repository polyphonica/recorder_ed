{% extends 'base.html' %}
{% load static %}

{% block title %}{{ lesson.subject.subject }} - Lesson Details{% endblock %}

{% block extra_head %}
<style>
.lesson-header {
    background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
    color: #065f46;
    padding: 2rem;
    border-radius: 8px;
    margin-bottom: 2rem;
}

.lesson-detail-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 0;
    border-bottom: 1px solid #e5e7eb;
}

.lesson-detail-item:last-child {
    border-bottom: none;
}

.lesson-detail-label {
    font-weight: 600;
    color: #374151;
    min-width: 140px;
}

.lesson-detail-value {
    color: #6b7280;
    flex: 1;
    text-align: right;
}

.status-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.875rem;
    font-weight: 500;
}

.status-assigned {
    background: #10b981;
    color: white;
}

.status-draft {
    background: #6b7280;
    color: white;
}

.payment-paid {
    color: #10b981;
    font-weight: 600;
}

.payment-unpaid {
    color: #f59e0b;
    font-weight: 600;
}

.content-section {
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
}

.content-section h3 {
    color: #065f46;
    font-weight: 600;
    margin-bottom: 1rem;
    border-bottom: 2px solid #10b981;
    padding-bottom: 0.5rem;
}

.attachment-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem;
    background: #f9fafb;
    border-radius: 6px;
    margin-bottom: 0.5rem;
}

.attachment-item:last-child {
    margin-bottom: 0;
}

.file-icon {
    color: #6b7280;
    width: 20px;
    height: 20px;
}

.private-note {
    background: #fef3c7;
    border: 1px solid #f59e0b;
    border-radius: 6px;
    padding: 1rem;
}

.empty-state {
    text-align: center;
    color: #9ca3af;
    font-style: italic;
    padding: 2rem;
}
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto p-6 max-w-6xl">
    <!-- Lesson Header with Details -->
    <div class="lesson-header">
        <div class="flex justify-between items-start">
            <div>
                <h1 class="text-3xl font-bold mb-4">{{ lesson.subject.subject }} | {{ lesson.student.get_full_name|default:"Unknown Student" }}</h1>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <div class="lesson-detail-item">
                            <span class="lesson-detail-label">Lesson Date:</span>
                            <span class="lesson-detail-value">{{ lesson.lesson_date|date:"M j, Y" }} {{ lesson.lesson_time|time:"g:i A" }}</span>
                        </div>
                        <div class="lesson-detail-item">
                            <span class="lesson-detail-label">Teacher:</span>
                            <span class="lesson-detail-value">{{ lesson.subject.teacher.get_full_name|default:"Unknown" }}</span>
                        </div>
                    </div>
                    <div>
                        <div class="lesson-detail-item">
                            <span class="lesson-detail-label">Duration:</span>
                            <span class="lesson-detail-value">{{ lesson.duration_in_minutes }} mins</span>
                        </div>
                        <div class="lesson-detail-item">
                            <span class="lesson-detail-label">Status:</span>
                            <span class="status-badge {% if lesson.status == 'Assigned' %}status-assigned{% else %}status-draft{% endif %}">{{ lesson.status }}</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="text-right">
                <div class="text-sm opacity-80 mb-2">Payment Status</div>
                <div class="{% if lesson.payment_status == 'Paid' %}payment-paid{% else %}payment-unpaid{% endif %} text-lg font-bold">
                    {{ lesson.payment_status }}
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="flex gap-4 mb-6">
        <a href="{% url 'private_teaching:calendar' %}" class="btn btn-outline">‚Üê Back to Calendar</a>
        {% if request.user == lesson.teacher.user %}
            <a href="{% url 'lessons:lesson_update' lesson.pk %}" class="btn btn-primary">Edit Lesson</a>
        {% endif %}
    </div>

    <!-- Lesson Settings -->
    <div class="content-section">
        <h3>Lesson Settings</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <div class="lesson-detail-item">
                    <span class="lesson-detail-label">Location:</span>
                    <span class="lesson-detail-value">{{ lesson.location }}</span>
                </div>
                <div class="lesson-detail-item">
                    <span class="lesson-detail-label">Attendance:</span>
                    <span class="lesson-detail-value">{{ lesson.attendance }}</span>
                </div>
            </div>
            <div>
                {% if lesson.zoom_link %}
                <div class="lesson-detail-item">
                    <span class="lesson-detail-label">Zoom Link:</span>
                    <span class="lesson-detail-value">
                        <a href="{{ lesson.zoom_link }}" target="_blank" class="text-blue-600 hover:text-blue-800 underline">
                            Click to Join Meeting
                        </a>
                    </span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Lesson Content -->
    {% if lesson.lesson_content %}
    <div class="content-section">
        <h3>Lesson Content</h3>
        <div class="prose max-w-none">
            {{ lesson.lesson_content|safe }}
        </div>
    </div>
    {% endif %}

    <!-- Teacher Notes -->
    {% if lesson.teacher_notes %}
    <div class="content-section">
        <h3>Teacher Notes</h3>
        <div class="prose max-w-none">{{ lesson.teacher_notes|linebreaks }}</div>
    </div>
    {% endif %}

    <!-- Homework -->
    {% if lesson.homework %}
    <div class="content-section">
        <h3>Homework</h3>
        <div class="prose max-w-none">{{ lesson.homework|linebreaks }}</div>
    </div>
    {% endif %}

    <!-- Private Notes (Teacher Only) -->
    {% if lesson.private_note and request.user == lesson.teacher.user %}
    <div class="content-section">
        <h3>Private Notes</h3>
        <div class="private-note">
            <div class="flex items-center gap-2 mb-2">
                <svg class="w-5 h-5 text-amber-500" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                </svg>
                <span class="font-medium text-amber-800">Private Notes (Not visible to students)</span>
            </div>
            <div class="whitespace-pre-wrap text-amber-800">{{ lesson.private_note }}</div>
        </div>
    </div>
    {% endif %}

    <!-- Documents -->
    {% if lesson.document_set.exists %}
    <div class="content-section">
        <h3>Documents</h3>
        {% for document in lesson.document_set.all %}
        <div class="attachment-item">
            <svg class="file-icon" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"></path>
            </svg>
            <div class="flex-1">
                <div class="font-medium">{{ document.title }}</div>
                <div class="text-sm text-gray-500">Uploaded {{ document.uploaded_at|date:"M j, Y" }}</div>
            </div>
            <a href="{{ document.document.url }}" target="_blank" class="text-blue-600 hover:text-blue-800 text-sm">
                Download
            </a>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- URL Attachments -->
    {% if lesson.lessonattachedurl_set.exists %}
    <div class="content-section">
        <h3>URL Attachments</h3>
        {% for url_attachment in lesson.lessonattachedurl_set.all %}
        <div class="attachment-item">
            <svg class="file-icon" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd"></path>
            </svg>
            <div class="flex-1">
                <div class="font-medium">{{ url_attachment.name }}</div>
                <div class="text-sm text-gray-500 break-all">{{ url_attachment.url }}</div>
            </div>
            <a href="{{ url_attachment.url }}" target="_blank" class="text-blue-600 hover:text-blue-800 text-sm">
                Visit
            </a>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Empty states for no content -->
    {% if not lesson.lesson_content and not lesson.teacher_notes and not lesson.homework and not lesson.document_set.exists and not lesson.lessonattachedurl_set.exists %}
    <div class="content-section">
        <div class="empty-state">
            <div class="text-lg mb-2">üìù No lesson content yet</div>
            <div>
                {% if request.user == lesson.teacher.user %}
                    <a href="{% url 'lessons:lesson_update' lesson.pk %}" class="text-blue-600 hover:text-blue-800">
                        Add lesson content, notes, or attachments
                    </a>
                {% else %}
                    Your teacher hasn't added lesson content yet.
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}