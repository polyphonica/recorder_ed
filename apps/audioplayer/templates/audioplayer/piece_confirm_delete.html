{% extends "base.html" %}
{% load static %}

{% block title %}Delete {{ piece.title }} - {{ block.super }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-2xl">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-error">Delete Piece</h1>
        <p class="text-base-content/70 mt-2">Are you sure you want to delete this piece?</p>
    </div>

    <!-- Warning Card -->
    <div class="card bg-base-100 shadow-md mb-6">
        <div class="card-body">
            <h2 class="card-title text-xl">{{ piece.title }}</h2>

            <div class="mt-4 space-y-2">
                <p class="text-sm">
                    <i class="fas fa-music mr-2"></i>
                    <strong>{{ piece.stems.count }}</strong> stem{{ piece.stems.count|pluralize }}
                </p>
                {% if piece.svg_image %}
                <p class="text-sm">
                    <i class="fas fa-image mr-2 text-success"></i>
                    Sheet music included
                </p>
                {% endif %}
            </div>

            {% if piece.stems.all %}
            <div class="mt-4">
                <p class="text-xs font-semibold uppercase text-base-content/50 mb-2">Tracks:</p>
                <div class="flex flex-wrap gap-2">
                    {% for stem in piece.stems.all %}
                    <span class="badge badge-outline badge-sm">{{ stem.instrument_name }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Usage Warning -->
    {% if usage_count > 0 %}
    <div class="alert alert-warning mb-6">
        <i class="fas fa-exclamation-triangle"></i>
        <div>
            <p class="font-semibold">Warning: This piece is used in {{ usage_count }} lesson{{ usage_count|pluralize }}!</p>
            {% if lessons_using %}
            <ul class="list-disc list-inside mt-2 ml-4">
                {% for lp in lessons_using %}
                <li class="text-sm">{{ lp.lesson.topic.course.title }} - {{ lp.lesson.lesson_title }}</li>
                {% endfor %}
                {% if usage_count > 5 %}
                <li class="text-sm italic">...and {{ usage_count|add:"-5" }} more</li>
                {% endif %}
            </ul>
            {% endif %}
            <p class="mt-2 text-sm font-semibold text-error">Deleting this piece will automatically remove it from all {{ usage_count }} lesson{{ usage_count|pluralize }}.</p>
        </div>
    </div>
    {% endif %}

    <!-- Confirmation Message -->
    <div class="alert alert-error mb-6">
        <i class="fas fa-trash"></i>
        <div>
            <p class="font-semibold">This action cannot be undone!</p>
            <p class="text-sm">The piece and all its audio stems will be permanently deleted.</p>
        </div>
    </div>

    <!-- Actions -->
    <form method="post" class="flex justify-end gap-4">
        {% csrf_token %}
        <a href="{% url 'audioplayer:piece_detail' pk=piece.id %}" class="btn btn-ghost">
            <i class="fas fa-arrow-left mr-2"></i>
            Cancel
        </a>
        <button type="submit" class="btn btn-error">
            <i class="fas fa-trash mr-2"></i>
            Yes, Delete Piece
        </button>
    </form>
</div>
{% endblock %}
